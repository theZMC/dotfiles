#!/usr/bin/env zsh

if [ -d "$1" ]; then
  ls -lart --color "$1"
  exit
fi

type=$(file --brief --dereference --mime -- "$1")

if [[ $type =~ image/ ]]; then
  if (( $+commands[viu] )); then
    viu -w "${FZF_PREVIEW_COLUMNS}" "$1"
  else
    echo "viu not installed; cannot preview image"
  fi
  exit
fi

if [[ $type =~ "=binary" ]]; then
  echo "Binary file; no preview available for file type: $type"
  exit
fi

if ! (( $+commands[bat] )); then
  cat "$1"
  exit
fi

bat --color=always --style=numbers --line-range :500 "$1" || echo "No preview available"
